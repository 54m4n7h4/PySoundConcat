<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Synthesizing output from matches &mdash; Concatenator 1.0 documentation</title>
    
    <link rel="stylesheet" href="static/basic.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="static/bootstrap-3.3.4/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="static/bootstrap-3.3.4/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="static/bootstrap-sphinx.js"></script>
    <link rel="top" title="Concatenator 1.0 documentation" href="index.html" />
    <link rel="up" title="API Usage Examples" href="examples.html" />
    <link rel="prev" title="Matching a target sample to a database" href="DatabaseMatchingExample.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          Concatenator</a>
        <span class="navbar-text navbar-version pull-left"><b>1.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="descriptor_defs.html">Audio Descriptor Definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="examples.html">API Usage Examples</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Synthesizing output from matches</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="DatabaseMatchingExample.html" title="Previous Chapter: Matching a target sample to a database"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Matching a ta...</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="sources/MatchSynthesisExample.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput > div,
div.nbinput div[class^=highlight],
div.nbinput div[class^=highlight] pre,
div.nboutput,
div.nboutput > div,
div.nboutput div[class^=highlight],
div.nboutput div[class^=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput > :first-child pre {
    color: navy;
}

/* output prompt */
div.nboutput > :first-child pre {
    color: darkred;
}

/* all prompts */
div.nbinput > :first-child[class^=highlight],
div.nboutput > :first-child[class^=highlight],
div.nboutput > :first-child {
    min-width: 11ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}

/* input/output area */
div.nbinput > :nth-child(2)[class^=highlight],
div.nboutput > :nth-child(2),
div.nboutput > :nth-child(2)[class^=highlight] {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
}

/* input area */
div.nbinput > :nth-child(2)[class^=highlight] {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput  > :nth-child(2).stderr {
    background: #fdd;
}

/* ANSI colors */
.ansiblack { color: black; }
.ansired { color: darkred; }
.ansigreen { color: darkgreen; }
.ansiyellow { color: #c4a000; }
.ansiblue { color: darkblue; }
.ansipurple { color: darkviolet; }
.ansicyan { color: steelblue; }
/* See https://github.com/jupyter/nbconvert/issues/174 */
.ansigray { color: gray; }  /* nbconvert CSS */
.ansigrey { color: gray; }  /* nbconvert HTML output */

.ansibgblack { background-color: black; }
.ansibgred { background-color: red; }
.ansibggreen { background-color: green; }
.ansibgyellow { background-color: yellow; }
.ansibgblue { background-color: blue; }
.ansibgpurple { background-color: magenta; }
.ansibgcyan { background-color: cyan; }
.ansibggray { background-color: gray; }

.ansibold { font-weight: bold; }
</style>
<div class="section" id="Synthesizing-output-from-matches">
<h1>Synthesizing output from matches<a class="headerlink" href="#Synthesizing-output-from-matches" title="Permalink to this headline">Â¶</a></h1>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [4]:
</pre></div>
</div>
<div class="highlight-ipython2"><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">sppysound.database</span> <span class="kn">import</span> <span class="n">AudioDatabase</span><span class="p">,</span> <span class="n">Synthesizer</span><span class="p">,</span> <span class="n">Matcher</span>
<span class="kn">import</span> <span class="nn">synthesis_config</span>
<span class="kn">import</span> <span class="nn">config</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [5]:
</pre></div>
</div>
<div class="highlight-ipython2"><div class="highlight"><pre>
<span class="n">source_dir</span> <span class="o">=</span> <span class="s">&quot;./ExampleDatabase&quot;</span>
<span class="n">target_dir</span> <span class="o">=</span> <span class="s">&quot;./ExampleTarget&quot;</span>
<span class="n">output_dir</span> <span class="o">=</span> <span class="s">&quot;./ExampleOutput&quot;</span>
</pre></div>
</div>
</div>
<p>Load source database. Also load the F0, RMS and Peak analyses for use
with amplitude and pitch enforcement.</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [6]:
</pre></div>
</div>
<div class="highlight-ipython2"><div class="highlight"><pre>
<span class="n">source_database</span> <span class="o">=</span> <span class="n">AudioDatabase</span><span class="p">(</span>
    <span class="n">source_dir</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">synthesis_config</span><span class="p">,</span>
    <span class="n">analysis_list</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;f0&quot;</span><span class="p">,</span> <span class="s">&quot;rms&quot;</span><span class="p">}</span>
<span class="p">)</span>
<span class="n">source_database</span><span class="o">.</span><span class="n">load_database</span><span class="p">(</span><span class="n">reanalyse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Load database used to generate matches to source database. This is used
when enforcing analyses such as RMS and F0. (Original grains are needed
to calculate the ratio to alter the synthesized grain by)</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
In [7]:
</pre></div>
</div>
<div class="highlight-ipython2"><div class="highlight"><pre>
<span class="n">target_database</span> <span class="o">=</span> <span class="n">AudioDatabase</span><span class="p">(</span>
    <span class="n">target_dir</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">synthesis_config</span><span class="p">,</span>
    <span class="n">analysis_list</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;f0&quot;</span><span class="p">,</span> <span class="s">&quot;rms&quot;</span><span class="p">}</span>
<span class="p">)</span>
<span class="n">target_database</span><span class="o">.</span><span class="n">load_database</span><span class="p">(</span><span class="n">reanalyse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">output_database</span> <span class="o">=</span> <span class="n">AudioDatabase</span><span class="p">(</span>
    <span class="n">output_dir</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">config</span>
<span class="p">)</span>
<span class="n">output_database</span><span class="o">.</span><span class="n">load_database</span><span class="p">(</span><span class="n">reanalyse</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">matcher</span> <span class="o">=</span> <span class="n">Matcher</span><span class="p">(</span>
    <span class="n">source_database</span><span class="p">,</span>
    <span class="n">target_database</span><span class="p">,</span>
    <span class="n">output_db</span><span class="o">=</span><span class="n">output_database</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
    <span class="n">rematch</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span>
<span class="n">matcher</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
    <span class="n">matcher</span><span class="o">.</span><span class="n">kdtree_matcher</span><span class="p">,</span>
    <span class="n">grain_size</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">matcher</span><span class="p">[</span><span class="s">&quot;grain_size&quot;</span><span class="p">],</span>
    <span class="n">overlap</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">matcher</span><span class="p">[</span><span class="s">&quot;overlap&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="container">
</div>
<div class="container">
<div class="highlight"><pre>
Traceback (most recent call last):
  File &quot;/Users/samuelperry/PerryPerrySource/pysource/sppysound/src/sppysound/database.py&quot;, line 157, in analyse_database
    config=self.config
  File &quot;/Users/samuelperry/PerryPerrySource/pysource/sppysound/src/sppysound/audiofile.py&quot;, line 943, in __enter__
    &quot;empty&quot;.format(self.name))
IOError: File isn&apos;t valid: ElectricGuitarSample-out_output.wav
Check that file is mono and isn&apos;t empty
</pre></div></div>
</div>
<p>Initialise the synthesizer object used for generating the final output.</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [8]:
</pre></div>
</div>
<div class="highlight-ipython2"><div class="highlight"><pre>
<span class="n">synthesizer</span> <span class="o">=</span> <span class="n">Synthesizer</span><span class="p">(</span>
    <span class="n">source_database</span><span class="p">,</span>
    <span class="n">output_database</span><span class="p">,</span>
    <span class="n">target_db</span><span class="o">=</span><span class="n">target_database</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">config</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Run synthesis. As with the matching, warnings may be generated. These
have all been accounted for and will be silenced in a future release.
The output audio can now be found in the audio folder of ./ExampleOutput</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
In [9]:
</pre></div>
</div>
<div class="highlight-ipython2"><div class="highlight"><pre>
<span class="n">synthesizer</span><span class="o">.</span><span class="n">synthesize</span><span class="p">(</span>
    <span class="n">grain_size</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">synthesizer</span><span class="p">[</span><span class="s">&quot;grain_size&quot;</span><span class="p">],</span>
    <span class="n">overlap</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">synthesizer</span><span class="p">[</span><span class="s">&quot;overlap&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>The synthesis_config.py file for this demo is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">rms</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;window_size&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s">&quot;overlap&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">analysis_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;f0&quot;</span><span class="p">:</span> <span class="s">&quot;log2_median&quot;</span><span class="p">,</span>
    <span class="s">&quot;rms&quot;</span><span class="p">:</span> <span class="s">&quot;mean&quot;</span>
<span class="p">}</span>

<span class="n">analysis</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;reanalyse&quot;</span><span class="p">:</span> <span class="bp">False</span>
<span class="p">}</span>

<span class="n">output_file</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;samplerate&quot;</span><span class="p">:</span> <span class="mi">44100</span><span class="p">,</span>
    <span class="s">&quot;format&quot;</span><span class="p">:</span> <span class="mi">131075</span><span class="p">,</span>
    <span class="s">&quot;channels&quot;</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>

<span class="n">synthesizer</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;enforce_rms&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="s">&quot;enf_rms_ratio_limit&quot;</span><span class="p">:</span> <span class="mf">5.</span><span class="p">,</span>
    <span class="s">&quot;enforce_f0&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="s">&quot;enf_f0_ratio_limit&quot;</span><span class="p">:</span> <span class="mf">10.</span><span class="p">,</span>
    <span class="s">&quot;grain_size&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s">&quot;overlap&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s">&quot;normalize&quot;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="c"># Defines the number of potential grains to choose from matches when</span>
    <span class="c"># synthesizing output.</span>
    <span class="s">&quot;match_quantity&quot;</span><span class="p">:</span> <span class="mi">20</span>
<span class="p">}</span>
</pre></div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2016, Sam Perry.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>